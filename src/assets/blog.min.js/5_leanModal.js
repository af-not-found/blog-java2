/*!
 * leanModal.js
 * https://github.com/FinelySliced/leanModal.js
 */
(function($) {

	$.fn.extend({
		leanModal : function(options) {

			// var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

			var defaults = {
				// top : (viewportHeight / 2)+"px",
				top : "50%",
				overlay : 0.5,
				closeButton : "#close_modal",
				callback : null
			};

			options = $.extend(defaults, options);

			return this.each(function() {
				var o = options;

				var modal_id = "#" + $(this).attr("id");
				$("#lean_overlay").click(function() {
					close_modal(modal_id, o.callback);
				});

				$(o.closeButton).click(function() {
					close_modal(modal_id, o.callback);
				});

				$(document).on("keydown.modal", function() {
					close_modal(modal_id, o.callback);
				});
				
				var modal_height = $(modal_id).outerHeight();
				var modal_width = $(modal_id).outerWidth();

				$('#lean_overlay').css({
					'display' : 'block',
					opacity : 0
				});

				$('#lean_overlay').fadeTo(200, o.overlay);
				$(modal_id).css({
					'display' : 'block',
					'margin-top' : -(modal_height / 2) + "px",
					'margin-left' : -(modal_width / 2) + "px",
					'top' : o.top
				});
				$(modal_id).fadeTo(200, 1);
			});

			function close_modal(modal_id, callback) {

				$("#lean_overlay").fadeOut(200);
				$(modal_id).css({
					'display' : 'none'
				});
				$(document).off("keydown.modal");

				if (callback) {
					callback();
				}
			}
		}
	});

})(jQuery);